<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Analytics Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { TrendingUp, Instagram, Video, Eye, Heart, MessageCircle, Share2, BarChart3, Sparkles, RefreshCw, Plus, ArrowUp, ArrowDown, Edit2, Trash2, Save, X, ExternalLink, Users, Settings, Link: LinkIcon } = lucide;

        // Lucide Icons CDN
        const LucideIcons = () => {
            useEffect(() => {
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/lucide@latest';
                document.head.appendChild(script);
            }, []);
            return null;
        };

        // Icon components (simple fallbacks)
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                'trending-up': 'üìà',
                'instagram': 'üì∑',
                'video': 'üé•',
                'eye': 'üëÅÔ∏è',
                'heart': '‚ù§Ô∏è',
                'message-circle': 'üí¨',
                'share-2': 'üîó',
                'bar-chart-3': 'üìä',
                'sparkles': '‚ú®',
                'refresh-cw': 'üîÑ',
                'plus': '‚ûï',
                'arrow-up': '‚¨ÜÔ∏è',
                'arrow-down': '‚¨áÔ∏è',
                'edit-2': '‚úèÔ∏è',
                'trash-2': 'üóëÔ∏è',
                'save': 'üíæ',
                'x': '‚ùå',
                'external-link': 'üîó',
                'users': 'üë•',
                'settings': '‚öôÔ∏è',
                'link': 'üîó'
            };
            return <span className={className} style={{ fontSize: size }}>{icons[name] || '‚Ä¢'}</span>;
        };

        // Data Service Layer
        class SocialDataService {
            constructor() {
                this.hootsuiteEnabled = false;
                this.hootsuiteApiKey = null;
            }

            async configureHootsuite(apiKey) {
                this.hootsuiteApiKey = apiKey;
                this.hootsuiteEnabled = true;
                if (typeof window.storage !== 'undefined') {
                    await window.storage.set('hootsuite-config', JSON.stringify({ 
                        enabled: true, 
                        apiKey 
                    }), true);
                } else {
                    localStorage.setItem('hootsuite-config', JSON.stringify({ enabled: true, apiKey }));
                }
            }

            async fetchFromHootsuite() {
                if (!this.hootsuiteEnabled) return null;
                console.log('Hootsuite integration ready - waiting for API connection');
                return null;
            }

            async syncPosts(manualPosts) {
                const hootsuiteData = await this.fetchFromHootsuite();
                if (hootsuiteData) {
                    const hootsuiteIds = new Set(hootsuiteData.map(p => p.id));
                    const manualOnly = manualPosts.filter(p => !hootsuiteIds.has(p.id));
                    return [...hootsuiteData, ...manualOnly];
                }
                return manualPosts;
            }
        }

        function SocialAnalyticsTracker() {
            const [posts, setPosts] = useState([]);
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const [loadingSuggestions, setLoadingSuggestions] = useState(false);
            const [showAddPost, setShowAddPost] = useState(false);
            const [editingPost, setEditingPost] = useState(null);
            const [loading, setLoading] = useState(true);
            const [showSettings, setShowSettings] = useState(false);
            const [dataService] = useState(() => new SocialDataService());
            const [hootsuiteConfig, setHootsuiteConfig] = useState({ enabled: false, apiKey: '' });
            const [newPost, setNewPost] = useState({
                platform: 'instagram',
                title: '',
                url: '',
                hashtags: '',
                views: '',
                likes: '',
                comments: '',
                shares: ''
            });

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const postsData = localStorage.getItem('social-posts');
                    const suggestionsData = localStorage.getItem('ai-suggestions');
                    const hootsuiteData = localStorage.getItem('hootsuite-config');
                    
                    if (postsData) setPosts(JSON.parse(postsData));
                    if (suggestionsData) setAiSuggestions(JSON.parse(suggestionsData));
                    if (hootsuiteData) {
                        const config = JSON.parse(hootsuiteData);
                        setHootsuiteConfig(config);
                        if (config.enabled) {
                            dataService.configureHootsuite(config.apiKey);
                        }
                    }
                } catch (error) {
                    console.log('Starting fresh');
                }
                setLoading(false);
            };

            const saveData = (updatedPosts) => {
                localStorage.setItem('social-posts', JSON.stringify(updatedPosts));
            };

            const totalMetrics = posts.reduce((acc, post) => ({
                views: acc.views + (post.metrics.views || 0),
                likes: acc.likes + (post.metrics.likes || 0),
                comments: acc.comments + (post.metrics.comments || 0),
                shares: acc.shares + (post.metrics.shares || 0)
            }), { views: 0, likes: 0, comments: 0, shares: 0 });

            const avgEngagementRate = totalMetrics.views > 0
                ? ((totalMetrics.likes + totalMetrics.comments + totalMetrics.shares) / totalMetrics.views * 100).toFixed(2)
                : 0;

            const addNewPost = () => {
                if (!newPost.title || !newPost.views) return;
                
                const post = {
                    id: Date.now(),
                    platform: newPost.platform,
                    title: newPost.title,
                    url: newPost.url,
                    timestamp: new Date().toISOString(),
                    metrics: {
                        views: parseInt(newPost.views) || 0,
                        likes: parseInt(newPost.likes) || 0,
                        comments: parseInt(newPost.comments) || 0,
                        shares: parseInt(newPost.shares) || 0
                    },
                    hashtags: newPost.hashtags.split(',').map(h => h.trim()).filter(h => h),
                    source: 'manual'
                };
                
                const updatedPosts = [post, ...posts];
                setPosts(updatedPosts);
                saveData(updatedPosts);
                setNewPost({ platform: 'instagram', title: '', url: '', hashtags: '', views: '', likes: '', comments: '', shares: '' });
                setShowAddPost(false);
            };

            const deletePost = (id) => {
                const updatedPosts = posts.filter(p => p.id !== id);
                setPosts(updatedPosts);
                saveData(updatedPosts);
            };

            const generateAISuggestions = async () => {
                setLoadingSuggestions(true);
                
                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [{
                                role: "user",
                                content: `Analyze this data and give 5 suggestions to increase engagement. Return ONLY JSON array: [{"category": "Content Strategy|Timing|Hashtags|Engagement|Format", "suggestion": "advice"}]

Posts: ${JSON.stringify(posts.map(p => ({ platform: p.platform, title: p.title, metrics: p.metrics })))}
Total Views: ${totalMetrics.views}, Engagement: ${avgEngagementRate}%`
                            }]
                        })
                    });

                    const data = await response.json();
                    const text = data.content.find(item => item.type === "text")?.text || "";
                    const jsonMatch = text.match(/\[[\s\S]*\]/);
                    if (jsonMatch) {
                        const suggestions = JSON.parse(jsonMatch[0]);
                        setAiSuggestions(suggestions);
                        localStorage.setItem('ai-suggestions', JSON.stringify(suggestions));
                    }
                } catch (error) {
                    console.error("AI error:", error);
                }
                
                setLoadingSuggestions(false);
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-500 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-3 rounded-xl">
                                        <Icon name="bar-chart-3" size={28} className="text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-800">Social Analytics Tracker</h1>
                                        <p className="text-sm text-gray-500">
                                            {hootsuiteConfig.enabled ? 'üîó Hootsuite Ready' : 'Manual Entry Mode'}
                                        </p>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setShowAddPost(!showAddPost)}
                                    className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 transition"
                                >
                                    <Icon name="plus" size={18} />
                                    Add Post
                                </button>
                            </div>

                            {showAddPost && (
                                <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-5 mb-4 border-2 border-purple-200">
                                    <h3 className="font-semibold mb-4">üìä Add New Post</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <select
                                            value={newPost.platform}
                                            onChange={(e) => setNewPost({...newPost, platform: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        >
                                            <option value="instagram">üì∑ Instagram</option>
                                            <option value="tiktok">üéµ TikTok</option>
                                        </select>
                                        <input
                                            type="text"
                                            placeholder="Post title *"
                                            value={newPost.title}
                                            onChange={(e) => setNewPost({...newPost, title: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                        <input
                                            type="number"
                                            placeholder="Views *"
                                            value={newPost.views}
                                            onChange={(e) => setNewPost({...newPost, views: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        />
                                        <input
                                            type="number"
                                            placeholder="Likes"
                                            value={newPost.likes}
                                            onChange={(e) => setNewPost({...newPost, likes: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        />
                                        <input
                                            type="number"
                                            placeholder="Comments"
                                            value={newPost.comments}
                                            onChange={(e) => setNewPost({...newPost, comments: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        />
                                        <input
                                            type="number"
                                            placeholder="Shares"
                                            value={newPost.shares}
                                            onChange={(e) => setNewPost({...newPost, shares: e.target.value})}
                                            className="px-4 py-2 border-2 border-purple-200 rounded-lg"
                                        />
                                    </div>
                                    <button
                                        onClick={addNewPost}
                                        className="px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90"
                                    >
                                        üíæ Save Post
                                    </button>
                                </div>
                            )}

                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl">
                                    <div className="flex items-center gap-2 text-blue-600 mb-1">
                                        <Icon name="eye" size={18} />
                                        <span className="text-sm font-medium">Total Views</span>
                                    </div>
                                    <p className="text-2xl font-bold">{totalMetrics.views.toLocaleString()}</p>
                                </div>
                                <div className="bg-gradient-to-br from-pink-50 to-pink-100 p-4 rounded-xl">
                                    <div className="flex items-center gap-2 text-pink-600 mb-1">
                                        <Icon name="heart" size={18} />
                                        <span className="text-sm font-medium">Likes</span>
                                    </div>
                                    <p className="text-2xl font-bold">{totalMetrics.likes.toLocaleString()}</p>
                                </div>
                                <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl">
                                    <div className="flex items-center gap-2 text-purple-600 mb-1">
                                        <Icon name="message-circle" size={18} />
                                        <span className="text-sm font-medium">Comments</span>
                                    </div>
                                    <p className="text-2xl font-bold">{totalMetrics.comments.toLocaleString()}</p>
                                </div>
                                <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl">
                                    <div className="flex items-center gap-2 text-green-600 mb-1">
                                        <Icon name="share-2" size={18} />
                                        <span className="text-sm font-medium">Shares</span>
                                    </div>
                                    <p className="text-2xl font-bold">{totalMetrics.shares.toLocaleString()}</p>
                                </div>
                                <div className="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-xl">
                                    <div className="flex items-center gap-2 text-orange-600 mb-1">
                                        <Icon name="trending-up" size={18} />
                                        <span className="text-sm font-medium">Engagement</span>
                                    </div>
                                    <p className="text-2xl font-bold">{avgEngagementRate}%</p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2">
                                <h2 className="text-xl font-bold mb-3">Your Posts ({posts.length})</h2>
                                {posts.length === 0 ? (
                                    <div className="bg-white rounded-xl shadow-md p-12 text-center">
                                        <p className="text-4xl mb-4">üì∑</p>
                                        <h3 className="text-lg font-semibold mb-2">No posts yet</h3>
                                        <p className="text-gray-500">Click "Add Post" to start tracking</p>
                                    </div>
                                ) : (
                                    posts.map(post => (
                                        <div key={post.id} className="bg-white rounded-xl shadow-md p-5 mb-4">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h3 className="font-semibold text-lg">{post.title}</h3>
                                                    <p className="text-xs text-gray-500">{new Date(post.timestamp).toLocaleDateString()}</p>
                                                </div>
                                                <button
                                                    onClick={() => deletePost(post.id)}
                                                    className="text-red-600 hover:bg-red-50 p-2 rounded"
                                                >
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                            <div className="grid grid-cols-4 gap-3">
                                                <div className="text-center">
                                                    <p className="text-xs text-gray-500">Views</p>
                                                    <p className="text-lg font-bold">{post.metrics.views.toLocaleString()}</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="text-xs text-gray-500">Likes</p>
                                                    <p className="text-lg font-bold text-pink-600">{post.metrics.likes.toLocaleString()}</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="text-xs text-gray-500">Comments</p>
                                                    <p className="text-lg font-bold text-blue-600">{post.metrics.comments.toLocaleString()}</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="text-xs text-gray-500">Shares</p>
                                                    <p className="text-lg font-bold text-green-600">{post.metrics.shares.toLocaleString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>

                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-xl shadow-md p-5 sticky top-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-xl font-bold">‚ú® AI Insights</h2>
                                        <button
                                            onClick={generateAISuggestions}
                                            disabled={loadingSuggestions || posts.length === 0}
                                            className="px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm rounded-lg disabled:opacity-50"
                                        >
                                            {loadingSuggestions ? 'Loading...' : 'Generate'}
                                        </button>
                                    </div>
                                    {aiSuggestions.length > 0 ? (
                                        <div className="space-y-3">
                                            {aiSuggestions.map((item, i) => (
                                                <div key={i} className="bg-gray-50 p-4 rounded-lg">
                                                    <div className="text-xs font-medium text-purple-600 mb-1">{item.category}</div>
                                                    <p className="text-sm text-gray-700">{item.suggestion}</p>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-center text-gray-500 text-sm py-8">
                                            {posts.length === 0 ? 'Add posts first' : 'Click Generate for AI tips'}
                                        </p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SocialAnalyticsTracker />);
    </script>
</body>
</html>
